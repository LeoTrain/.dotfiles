#!/bin/bash

repos=(
  "$HOME/.dotfiles"
  "$HOME/lab/libft"
  "$HOME/lab/ft_printf"
  "$HOME/lab/get_next_line"
  "$HOME/lab/MiniTalk"
)

all_clean=true

for repo in "${repos[@]}"; do
  repo_name=$(basename "$repo")

  if [ ! -d "$repo/.git" ]; then
    echo "$repo_name: Not a git repository."
    all_clean=false
    continue
  fi

  git -C "$repo" fetch

  LOCAL=$(git -C "$repo" rev-parse @)
  REMOTE=$(git -C "$repo" rev-parse @{u} 2>/dev/null)
  BASE=$(git -C "$repo" merge-base @ @{u} 2>/dev/null)

  if [ "$REMOTE" = "$BASE" ]; then
    echo "$repo_name: üîº You have commits to push."
    all_clean=false
  elif [ "$LOCAL" = "$BASE" ]; then
    echo "$repo_name: üîΩ There are commits to pull."
    all_clean=false
  else
    echo "$repo_name: ‚ö†Ô∏è Branch has diverged."
    all_clean=false
  fi
done

if $all_clean; then
  notify-send -u low "Git Push Check" "‚úÖ All repositories are up-to-date."
else
  notify-send -u critical "Git Push Check" "‚ö†Ô∏è Some repositories need to be pushed or pulled."
fi
